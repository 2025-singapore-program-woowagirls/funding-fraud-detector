# 이상 거래 패턴 탐지 피처 분석 보고서

## 목차
- [Pattern 1: 펀딩피 차익거래](#pattern-1-펀딩피-차익거래-funding-fee-arbitrage)
- [Pattern 2: 조직적 거래](#pattern-2-조직적-거래-organized-trading)
- [Pattern 3: 보너스 악용](#pattern-3-보너스-악용-bonus-abuse)
- [임계값 설정 방법론](#임계값-설정-방법론)

---

## Pattern 1: 펀딩피 차익거래 (Funding Fee Arbitrage)

### 1. 펀딩피 절댓값 (funding_fee_abs)

**사용 데이터셋:**
- `Funding.csv`의 `funding_fee` 컬럼
- 계산 방식: `abs(funding_fee)` (절댓값)
- 거래 단위별 펀딩비 금액

**실제 데이터 분포:**
- 평균: $8.06
- 중앙값: $0.28
- 표준편차: $44.45
- 90th percentile: $11.16
- 95th percentile: $30.88
- 99th percentile: $175.99

**해석:**
대부분의 정상 거래에서는 펀딩비가 $0~$2 사이의 작은 금액으로 발생합니다. 상위 5%의 거래는 평균 $123.87의 펀딩비를 받는 반면, 하위 95%는 평균 $1.96에 불과합니다 (**63.2배 차이**).

**탐지 기준 및 선정 이유:**

- **의심 (Suspicious)**: **$11.16** (90th percentile)
  - 통계적 근거: 상위 10%에 해당하는 값
  - 도메인 근거:
    - 일반적인 펀딩비율은 0.01% ~ 0.1% per cycle (8시간)
    - BTC $80,000 기준, 1 BTC 포지션이면 약 $8의 펀딩비 발생
    - $10 이상은 **고레버리지 + 큰 포지션**을 의미
  - 금융 기준: 펀딩비율 0.01% (바이낸스 기본값)를 크게 벗어남

- **고위험 (High Risk)**: **$30.88** (95th percentile)
  - 통계적 근거: 상위 5%에 해당하는 극단적 이상치
  - 도메인 근거:
    - 변동성 >80% 시기에도 펀딩비율 0.1-0.5%가 일반적
    - $30 이상은 **대규모 펀딩비 차익거래 전략**의 신호
  - 금융 기준: IQR method의 극단적 이상치 기준($8.07)보다 3.8배 높음

**피처 유의미성:** ✅ **매우 유의미** (상위/하위 그룹 간 63.2배 차이)

---

### 2. 포지션 보유시간 (mean_holding_minutes)

**사용 데이터셋:**
- `Trade.csv`의 `ts` (타임스탬프), `openclose` (OPEN/CLOSE) 컬럼
- 계산 방식:
  1. 계정별, 심볼별로 거래 그룹화
  2. OPEN 거래 시 타임스탬프 기록
  3. CLOSE 거래 시 보유시간 = (CLOSE 시각 - OPEN 시각) / 60
  4. 계정별 평균 보유시간 계산

**실제 데이터 분포:**
- 평균: 165.8분 (약 2.8시간)
- 중앙값: 165.8분
- 10th percentile: 10.8분
- 25th percentile: 59.3분

**해석:**
중앙값이 165.8분(약 2.8시간)인 것은 대부분의 거래자가 2~3시간 정도 포지션을 보유함을 의미합니다. 펀딩비는 8시간(480분)마다 발생하므로, 정상적인 거래자는 펀딩비 수령 주기보다 훨씬 짧게 포지션을 보유합니다.

**탐지 기준 및 선정 이유:**

- **고위험 (High Risk)**: **10.8분** (10th percentile, **짧을수록 위험**)
  - 통계적 근거: 하위 10%에 해당 (짧은 보유시간)
  - 도메인 근거:
    - **스캘핑 전략**: 일반적으로 5-30분 차트 사용, 몇 분에서 몇 시간 보유
    - **펀딩비 차익거래**: 입문가는 펀딩 시각 ±30분 이내에 포지션 진입/청산
    - **10분은 펀딩비 수령만 목적으로 한 최소 보유시간**에 해당
  - 금융 기준:
    - HFT (고빈도 거래): 초~분 단위 (알고리즘 트레이딩)
    - 일반 스캘핑: 15분 ~ 1시간
    - **10분 이하는 명백한 펀딩비 차익거래 또는 초단타 전략**

- **의심 (Suspicious)**: **59.3분** (25th percentile)
  - 통계적 근거: 하위 25%에 해당
  - 도메인 근거:
    - 펀딩비 수령 주기(480분)의 1/8 수준
    - 펀딩 시각 ±30분 = 60분 window 내 거래
  - 금융 기준: 1시간 미만은 단기 트레이딩으로 분류

**피처 유의미성:** ✅ **유의미** (짧은 보유시간이 펀딩 차익거래와 강한 상관관계)

---

### 3. 펀딩 시각 거래 집중도 (funding_timing_ratio)

**사용 데이터셋:**
- `Trade.csv`의 `ts` (타임스탬프)
- 계산 방식:
  1. 펀딩 시각 정의: 0시, 4시, 8시, 12시, 16시, 20시 (±30분)
  2. 계정별 전체 거래 건수 계산
  3. 펀딩 시각(±30분) 내 거래 건수 계산
  4. 비율 = 펀딩 시각 거래 건수 / 전체 거래 건수

**실제 데이터 분포:**
- 평균: 26.08%
- 중앙값: 25.01%
- 75th percentile: 27.73%
- 90th percentile: 36.73%

**해석:**
이론적으로 거래가 완전히 랜덤하다면 펀딩 시각(±30분) 거래 비율은 약 25%가 되어야 합니다 (6시간 / 24시간 = 25%). 실제 데이터의 중앙값이 25.01%로 이론값과 거의 일치하는 것은 **대부분의 거래자가 펀딩 시각을 의식하지 않고 거래**함을 의미합니다.

**탐지 기준 및 선정 이유:**

- **의심 (Suspicious)**: **27.73%** (75th percentile)
  - 통계적 근거: 상위 25%에 해당
  - 도메인 근거:
    - 이론적 랜덤 (25%)보다 약간 높은 수준
    - **펀딩 시각을 의식하는 거래 패턴 시작점**
  - 금융 기준:
    - Active 펀딩 차익거래 전략: 일일 회전율 30-50%
    - 27%는 펀딩 시각을 어느 정도 고려하기 시작하는 수준

- **고위험 (High Risk)**: **36.73%** (90th percentile)
  - 통계적 근거: 상위 10%에 해당
  - 도메인 근거:
    - 이론적 랜덤보다 약 **50% 높은 수준**
    - 거래의 1/3 이상이 펀딩 시각에 집중
    - **명확한 펀딩 시각 집중 패턴, 차익거래 의도 명백**
  - 금융 기준: 50% 이상이면 거래의 절반이 펀딩 시각에 집중 (극단적)

**피처 유의미성:** ✅ **유의미** (상위 10%는 하위 90%보다 1.8배 높은 집중도)

---

### 4. 펀딩피 수익 비중 (funding_profit_ratio)

**사용 데이터셋:**
- `Funding.csv`의 `funding_fee` 합계 (절댓값)
- `Trade.csv`의 OPEN/CLOSE `amount` 차이로 실현손익(PnL) 계산
- 계산 방식:
  1. position_id별로 OPEN과 CLOSE 매칭
  2. 실현손익(PnL) = CLOSE amount - OPEN amount
  3. 계정별 총 PnL과 총 펀딩비 합산
  4. 비율 = abs(펀딩비 합계) / (abs(실현손익) + abs(펀딩비 합계))

**실제 데이터 분포:**
- 평균: 10.62%
- 중앙값: 1.93%
- 표준편차: 19.02%
- 75th percentile: 10.05%
- 90th percentile: 37.38%
- 95th percentile: 55.89%

**해석:**
대부분의 정상 거래자는 수익의 1.93%(중앙값)만 펀딩비로 벌고, 나머지는 실제 거래 차익으로 벌어들입니다. 그러나 상위 10%는 수익의 **37.38% 이상을 펀딩비로** 벌고 있으며, 상위 5%는 **55.89% 이상**을 펀딩비로 벌고 있습니다. 이는 거래 차익보다 **펀딩비 수령이 주요 수익원**임을 의미합니다.

**탐지 기준 및 선정 이유:**

- **의심 (Suspicious)**: **10.05%** (75th percentile)
  - 통계적 근거: 상위 25%에 해당
  - 도메인 근거:
    - **일반 트레이더**: 수익의 대부분(>90%)이 거래 차익에서 발생
    - **펀딩비는 부수적 수익**: 정상적인 트레이더는 펀딩비를 의식하지 않음
    - 10%는 펀딩비를 의식하기 시작하는 수준
  - 금융 기준:
    - 펀딩비는 포지션 유지 비용 또는 수익의 일부
    - **10% 이상이면 펀딩비를 의도적으로 수취하는 전략**

- **고위험 (High Risk)**: **37.38%** (90th percentile)
  - 통계적 근거: 상위 10%에 해당하는 극단적 패턴
  - 도메인 근거:
    - 수익의 1/3 이상이 펀딩비에서 발생
    - **명백한 펀딩비 차익거래 전략 (Funding Arbitrage)**
    - 거래 차익은 부차적, 펀딩비 수령이 주목적
  - 금융 기준:
    - 바이낸스/바이빗의 펀딩비 차익거래 가이드: 짧은 보유시간 + 펀딩 시각 집중
    - **37% 이상은 전문적인 펀딩비 헌터(Funding Hunter)**
    - 실제 펀딩 차익거래 연구: 수익의 50-70%가 펀딩비에서 발생

**피처 유의미성:** ✅ **매우 유의미** (상위 10%는 하위 90%보다 **12.09배 높은** 펀딩비 비중)

---

## Pattern 2: 조직적 거래 (Organized Trading)

### 1. IP 공유 비율 (ip_shared_ratio)

**사용 데이터셋:**
- `IP.csv`의 `ip`, `account_id` 컬럼
- 계산 방식:
  1. IP별 계정 수 계산
  2. 단독 IP (1개 계정), 2개 공유, 3개 이상 공유로 분류

**실제 데이터 분포:**
- 총 IP 수: 2,231개
- 단독 IP: 2,212개 (99.1%)
- 2개 계정 공유: 19개 (0.9%)
- 3개 이상 공유: 0개 (0.0%)

**해석:**
압도적인 대다수(99.1%)가 1개의 계정만 사용하는 정상적인 IP입니다. **IP를 공유하는 것 자체가 매우 드문 현상**이므로, 2개 이상의 계정이 동일 IP를 사용하면 즉시 의심 대상이 됩니다.

**탐지 기준 및 선정 이유:**

- **의심 (Suspicious)**: **2개 계정 공유**
  - 통계적 근거: 전체의 0.9%만 해당하는 희귀 케이스
  - 도메인 근거:
    - **바이낸스**: KYC로 1인 1계정 보장, 다중 계정은 규제 준수 위반
    - **바이빗**: 1인 1계정 정책, IP/디��이스/거래 패턴으로 계정 연결 감지
  - 금융 기준:
    - 거래소는 IP, 디바이스 데이터, 거래 패턴으로 연결된 계정 감지
    - 가족/동거인 공유 가능성 배제 불가하나 의심 필요
  - 업계 정책: 합법적 다중 계정은 비즈니스 계정 또는 VIP 서브 계정만 허용

- **고위험 (High Risk)**: **3개 이상 계정 공유**
  - 통계적 근거: 현재 데이터에서는 0건이지만, 명백한 조직적 운영
  - 도메인 근거:
    - 거래소 ToS(이용약관) 명시적 금지
    - **연결된 계정은 함께 폐쇄될 수 있음** (바이빗 정책)
  - 금융 기준: 개인 사용자가 3개 이상 계정을 동일 IP에서 운영할 합리적 이유 부재

**피처 유의미성:** ✅ **매우 유의미** (공유 자체가 이상 신호, 거래소 정책 위반)

---

### 2. 평균 레버리지 (mean_leverage)

**사용 데이터셋:**
- `Trade.csv`의 `leverage` 컬럼
- 계산 방식: 계정별 거래의 레버리지 평균값

**실제 데이터 분포:**
- 평균: 12.4배
- 중앙값: 7.9배
- 75th percentile: 14.1배
- 90th percentile: 31.3배
- 95th percentile: 42.6배

**해석:**
대부분의 거래자가 10배 내외의 보수적인 레버리지를 사용합니다 (중앙값 7.9배). 상위 10%는 평균 31.3배 이상의 레버리지를 사용하며, 이는 **고위험 투기 거래 또는 조직적 단타 매매**의 특징입니다.

**탐지 기준 및 선정 이유:**

- **의심 (Suspicious)**: **14.1배** (75th percentile)
  - 통계적 근거: 상위 25%에 해당
  - 도메인 근거:
    - **초보자 권장**: 2-3배 (리스크 최소화)
    - **안전한 범위**: 5-10배 (청산 여유 확보)
    - 14.1배는 일반 투자자(10배)보다 공격적
  - 금융 기준:
    - 변동성 큰 암호화폐 시장에서 10배 이상은 주의 필요
    - **미국 CFTC 규제**: 소매 투자자 최대 10배

- **고위험 (High Risk)**: **31.3배** (90th percentile)
  - 통계적 근거: 상위 10%에 해당
  - 도메인 근거:
    - **바이낸스**: 일반 50배, BTC 선물 최대 125배 제공
    - **바이빗**: 최대 100배
    - 31.3배는 거래소 최대치의 30-60% 수준
  - 금융 기준:
    - **50배 이상**: 빠른 청산 위험, 극단적 고위험
    - 31.3배는 공격적 투자자(20-50배) 범위의 상위권
    - **조직적 단타 매매나 시장 조작에 유리**

**피처 유의미성:** ✅ **유의미** (금융권 기준과 부합, 상위 그룹 명확히 구분)

---

## Pattern 3: 보너스 악용 (Bonus Abuse)

### 1. 총 보너스 수령액 (total_reward)

**사용 데이터셋:**
- `Reward.csv`의 `reward_amount` 컬럼
- 계산 방식: 계정별 보너스 수령액 합계

**실제 데이터 분포:**
- 평균: $157.42
- 중앙값: $40.00
- 75th percentile: $159.99
- 90th percentile: $534.90
- 95th percentile: $584.81

**해석:**
대부분의 계정이 $40 내외의 보너스를 1회 수령합니다 (중앙값 $40). 평균($157.42)이 중앙값($40)보다 4배 가까이 높은 것은 소수의 계정이 과도하게 많은 보너스를 받음을 의미합니다.

**탐지 기준 및 선정 이유:**

- **의심 (Suspicious)**: **$159.99** (75th percentile)
  - 통계적 근거: 상위 25%에 해당
  - 도메인 근거:
    - **바이낸스**: 신규 사용자 최대 $100-$600 (캐시백 포함)
    - **OKX**: 최대 $10,000 (미스터리 박스 포함)
    - **일반 가입 보너스**: $10-$50
    - $159.99는 일반 가입 보너스의 3~4배
  - 금융 기준:
    - 복수 프로모션 참여 또는 리퍼럴 보너스 가능성
    - 정상적인 1회 수령 범위 초과

- **고위험 (High Risk)**: **$534.90** (90th percentile)
  - 통계적 근거: 상위 10%에 해당
  - 도메인 근거:
    - **바이빗**: 티어별 최대 $30,050 (기본 $50)
      - $50: 입금 $500 + 거래 $5,000
      - 더 높은 보너스는 매우 큰 입금/거래량 필요
    - $534.90은 일반 가입 보너스의 **10배 이상**
  - 금융 기준:
    - **다중 계정 보너스 악용 강력 의심**
    - 거래소 정책상 1인 1계정 1회 보너스가 원칙

**피처 유의미성:** ✅ **유의미** (상위 그룹이 일반 보너스의 10배 이상 수령)

---

### 2. 보너스 계정 IP 공유 (shared_ip)

**사용 데이터셋:**
- `Reward.csv`의 `account_id`
- `IP.csv`의 `ip`, `account_id`
- 조합 방식: 보너스를 받은 계정만 필터링하여 IP 공유 여부 분석

**실제 데이터 분포:**
- 총 보너스 계정 IP: 1,813개
- 단독 IP: 1,805개 (99.6%)
- 2개 계정 공유: 8개 (0.4%)
- 3개 이상 공유: 0개 (0.0%)

**해석:**
보너스를 받은 계정 중 99.6%가 단독 IP를 사용하며, **IP를 공유하는 보너스 계정은 극히 드뭅니다 (0.4%)**. 8개의 IP에서만 2개의 계정이 보너스를 수령했는데, 이는 **동일 IP에서 다중 계정을 생성하여 보너스를 중복 수령**했을 가능성이 매우 높습니다.

**탐지 기준 및 선정 이유:**

- **의심 (Suspicious)**: **2개 계정 공유**
  - 통계적 근거: 전체의 0.4%만 해당하는 극히 희귀 케이스
  - 도메인 근거:
    - 거래소는 **보너스 중복 수령 방지**를 위해 IP/디바이스/KYC 체크
    - 바이낸스/바이빗 모두 1인 1계정 정책 엄격 시행
  - 금융 기준:
    - 가족/동거인 동시 가입 가능성 있으나 매우 의심스러움
    - 보너스 조건: "출금까지 일정 거래량 필요" (악용 방지)

- **고위험 (High Risk)**: **3개 이상 계정 공유**
  - 통계적 근거: 현재 데이터에서는 0건
  - 도메인 근거:
    - **명백한 보너스 악용**
    - 거래소 ToS 위반, 계정 정지 대상
  - 금융 기준:
    - 개인이 3개 이상 계정을 동일 IP에서 생성하여 보너스 받을 합리적 이유 없음
    - 거래소는 판매/구매/공유/양도 모두 금지 (바이빗 ToS)

**피처 유의미성:** ✅ **매우 유의미** (공유 자체가 보너스 악용의 강력한 증거, 거래소 정책 명백한 위반)

---

### 3. 거래 활동 여부 (has_trades) - **미사용**

**사용 데이터셋:**
- `Reward.csv`의 `account_id`
- `Trade.csv`의 `account_id`
- 계산 방식: 보너스 수령 계정이 거래 데이터에 존재하는지 여부

**실제 데이터 분포:**
- 총 보너스 계정: 49개
- 거래 있음: 49개 (100.0%)
- 거래 없음: 0개 (0.0%)

**미사용 이유:**
1. **변별력 없음**: 100%가 거래 활동이 있어 정상/이상 구분 불가
2. **데이터 특성**: 본 데이터셋은 거래 데이터만 포함되어 있으며, 보너스만 받고 거래하지 않은 계정은 애초에 Trade.csv에 기록되지 않음
3. **실무적 한계**:
   - 거래소 정책상 대부분 **최소 거래량 조건** 필요
   - 보너스 조건: "출금 전 일정 거래량 달성" (예: $5,000)
   - 보너스만 받고 출금하는 것이 구조적으로 불가능
4. **도메인 지식**:
   - 바이빗: $50 보너스 받으려면 입금 $500 + 거래 $5,000 필요
   - 모든 거래소가 유사한 조건 부과

**피처 유의미성:** ❌ **미사용** (100% 거래 있음, 변별력 없음, 데이터 수집 방식의 한계)

---

## 임계값 설정 방법론

본 프로젝트에서는 다음 3가지 방법론을 병행하여 신뢰할 수 있는 임계값을 설정했습니다:

### 1. 통계적 백분위수 (Percentile-based)
- **의심 (Suspicious)**: 75th percentile
- **고위험 (High Risk)**: 90th percentile 또는 95th percentile
- **근거**: 상위 10~25%는 통계적으로 유의미한 이상치로 간주

### 2. 암호화폐 거래 도메인 기준 참조
- **펀딩비율**: 0.01% (바이낸스 기본) ~ 0.1% (고변동성)
- **펀딩비 차익거래 보유시간**: 몇 분 전 진입 ~ 펀딩 시각 후 청산
- **스캘핑**: 5-30분 차트, 15분~1시간 보유
- **레버리지**:
  - 초보자 2-3배, 안전 5-10배, 공격적 20-50배
  - 미국 규제 최대 10배 (CFTC)
  - 바이낸스/바이빗 최대 100-125배
- **보너스**: 일반 $10-$50, 대형 프로모션 $100-$600
- **다중 계정**: 1인 1계정 정책 (KYC), IP/디바이스/패턴 감지

### 3. 유의미성 검증
- 상위 그룹과 하위 그룹 간 평균값 비교
- 최소 1.5배 이상 차이 시 유의미한 피처로 판단
- 예: 펀딩피 절댓값 (63.2배 차이), 펀딩 시각 집중도 (1.8배 차이)

---

## 피처 최종 선정 결과

### ✅ 사용 피처 (8개)

**Pattern 1 (펀딩피 차익거래):**
1. 펀딩피 절댓값 - 변별력 ★★★★★ (63.2배 차이)
2. 포지션 보유시간 - 변별력 ★★★★☆ (스캘핑 5-30분 기준 부합)
3. 펀딩 시각 거래 집중도 - 변별력 ★★★☆☆ (1.8배 차이)
4. **펀딩피 수익 비중** - 변별력 ★★★★★ (12.09배 차이)

**Pattern 2 (조직적 거래):**
5. IP 공유 비율 - 변별력 ★★★★★ (99.1% 정상, 거래소 정책 위반)
6. 평균 레버리지 - 변별력 ★★★☆☆ (금융 기준 부합)

**Pattern 3 (보너스 악용):**
7. 총 보너스 수령액 - 변별력 ★★★★☆ (일반의 10배)
8. 보너스 계정 IP 공유 - 변별력 ★★★★★ (99.6% 정상, 명백한 악용)

### ❌ 미사용 피처 (1개)

1. **거래 활동 여부**: 100% 거래 있음 (데이터 수집 방식의 한계)

---

## 결론

본 분석을 통해 총 9개의 피처 중 **8개를 최종 선정**하였으며, 모두 **통계적 근거**, **암호화폐 거래소 도메인 지식**, **금융 규제 기준**을 바탕으로 신뢰할 수 있는 임계값을 설정했습니다.

선정된 피처들은 실제 데이터에서 정상 거래와 이상 거래를 명확히 구분할 수 있는 변별력을 보였으며, 업계 표준 및 거래소 정책과도 일치합니다.

### 핵심 발견사항

1. **펀딩피 절댓값 (63.2배 차이)**: 가장 강력한 변별력, 상위 5%는 명백한 차익거래
2. **펀딩피 수익 비중 (12.09배 차이)**: 수익의 37% 이상이 펀딩비면 전문 펀딩비 헌터
3. **IP 공유 (99.1% 정상)**: 거래소 1인 1계정 정책 위반, 즉시 탐지 가능
4. **보너스 IP 공유 (99.6% 정상)**: 보너스 악용의 결정적 증거

이러한 피처들은 펀딩피 차익거래, 조직적 거래, 보너스 악용 패턴을 효과적으로 탐지할 수 있으며, 향후 머신러닝 기반 자동 탐지 시스템으로 확장 가능합니다.

---

## 참고 자료

### 데이터 출처
- 암호화폐 무기한 선물 거래소 실제 거래 데이터
- 분석 기간: 2025년 1월~3월
- 데이터 규모: Funding 52,694건, Trade 52,953건, Reward 198건, IP 2,231건

### 도메인 참고 문헌
- Binance Academy - Leverage in Crypto Trading
- Crypto Fund 101 - Funding Fee Arbitrage Strategy
- Binance/Bybit/OKX - Terms of Service & KYC Policies
- CFTC Regulations on Cryptocurrency Derivatives
- Coinbase/Amberdata - Funding Rate Arbitrage Guides
