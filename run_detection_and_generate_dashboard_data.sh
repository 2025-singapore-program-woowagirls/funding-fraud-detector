#!/bin/bash

# ============================================================
# ì´ìƒ ê±°ë˜ íƒì§€ ë° Grafana ëŒ€ì‹œë³´ë“œ ë°ì´í„° ìƒì„± ìŠ¤í¬ë¦½íŠ¸
# ============================================================

set -e  # ì˜¤ë¥˜ ë°œìƒ ì‹œ ì¤‘ë‹¨

# í”„ë¡œì íŠ¸ ë£¨íŠ¸ ë””ë ‰í† ë¦¬ë¡œ ì´ë™
cd "$(dirname "$0")"

echo "======================================================================================================"
echo "ì´ìƒ ê±°ë˜ íƒì§€ ì‹œìŠ¤í…œ - Grafana ëŒ€ì‹œë³´ë“œ ë°ì´í„° ìƒì„±"
echo "======================================================================================================"
echo ""

# ê°€ìƒí™˜ê²½ í™œì„±í™”
echo "ğŸ”§ ê°€ìƒí™˜ê²½ í™œì„±í™” ì¤‘..."
source .venv/bin/activate

# 1. í†µí•© íƒì§€ ì‹¤í–‰
echo ""
echo "======================================================================================================"
echo "1ï¸âƒ£  í†µí•© ì´ìƒ ê±°ë˜ íƒì§€ ì‹¤í–‰ ì¤‘..."
echo "======================================================================================================"
python detection/integrated_detection.py

# 2. Grafana ëŒ€ì‹œë³´ë“œìš© ë°ì´í„° ìƒì„±
echo ""
echo "======================================================================================================"
echo "2ï¸âƒ£  Grafana ëŒ€ì‹œë³´ë“œìš© ì¶”ê°€ ë°ì´í„° ìƒì„± ì¤‘..."
echo "======================================================================================================"
python visualize/create_grafana_dashboard_data.py

# 3. SQLite ë°ì´í„°ë² ì´ìŠ¤ ìƒì„±
echo ""
echo "======================================================================================================"
echo "3ï¸âƒ£  SQLite ë°ì´í„°ë² ì´ìŠ¤ ìƒì„± ì¤‘..."
echo "======================================================================================================"
python visualize/convert_csv_to_sqlite.py

# ì™„ë£Œ
echo ""
echo "======================================================================================================"
echo "âœ… ëª¨ë“  ì‘ì—… ì™„ë£Œ!"
echo "======================================================================================================"
echo ""
echo "ğŸ“ ìƒì„±ëœ íŒŒì¼:"
echo "   - output/final/integrated_detection_results.csv"
echo "   - output/final/high_risk_accounts_detected.csv"
echo "   - output/final/grafana_*.csv (7ê°œ)"
echo "   - output/final/detection.db"
echo ""
echo "ğŸ“Š Grafana ëŒ€ì‹œë³´ë“œ ì„¤ì •:"
echo "   1. HTTP ì„œë²„ ì‹œì‘:"
echo "      cd output/final && python3 -m http.server 8080"
echo ""
echo "   2. Grafana ì ‘ì†:"
echo "      http://localhost:3000"
echo ""
echo "   3. ìƒì„¸ ê°€ì´ë“œ:"
echo "      visualize/GRAFANA_BEGINNER_GUIDE.md ì°¸ì¡°"
echo ""
echo "======================================================================================================"
